<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>ğŸŒ Travel Planner</title>
    <link rel="stylesheet" href="static/css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
</head>
<body>
<div class="container">
    <h1>ğŸŒ Travel Planner</h1>
    <div class="form-group">
        <input type="text" id="start" placeholder="Enter Start Location" />
        <input type="text" id="dest" placeholder="Enter Destination Location" />
        <select id="lang"></select>
        <select id="mode">
            <option value="manual">Manual</option>
            <option value="voice">Voice</option>
        </select>
        <button onclick="planTrip()">Plan Trip</button>
    </div>
    <div id="results"></div>
</div>

<script>
    const langSelect = document.getElementById('lang');
    const languages = {
        "en":"English","zh-cn":"Chinese","es":"Spanish","fr":"French",
        "hi":"Hindi","ja":"Japanese","de":"German","it":"Italian","ru":"Russian"
    };
    for (let code in languages) {
        let opt = document.createElement('option');
        opt.value = code;
        opt.text = languages[code];
        langSelect.add(opt);
    }
    let browserLang = navigator.language.toLowerCase();
    if (languages[browserLang]) langSelect.value = browserLang;

    // Translation dictionary for static UI labels
    const uiTranslations = {
        "en": {
            distance_time: "ğŸ“ Distance & Time",
            weather: "ğŸŒ¤ Weather",
            traffic: "ğŸš¦ Traffic",
            transport_options: "ğŸš— Transport Options",
            recommendation: "ğŸ“¢ Recommendation",
            summary: "ğŸ“„ Summary",
            transport_list: ["ğŸš— Car", "ğŸš¶â€â™‚ï¸ Walk", "ğŸš´â€â™‚ï¸ Bike", "âœˆï¸ Plane"],
            placeholder_start: "Enter Start Location",
            placeholder_dest: "Enter Destination Location",
            button_plan: "Plan Trip",
            mode_labels: {"walk":"Walk", "bike":"Bike", "car":"Car", "plane":"Plane"},
        },
        "zh-cn": {
            distance_time: "ğŸ“ è·ç¦»å’Œæ—¶é—´",
            weather: "ğŸŒ¤ å¤©æ°”",
            traffic: "ğŸš¦ äº¤é€šçŠ¶å†µ",
            transport_options: "ğŸš— äº¤é€šæ–¹å¼",
            recommendation: "ğŸ“¢ å»ºè®®",
            summary: "ğŸ“„ æ‘˜è¦",
            transport_list: ["ğŸš— æ±½è½¦", "ğŸš¶â€â™‚ï¸ æ­¥è¡Œ", "ğŸš´â€â™‚ï¸ è‡ªè¡Œè½¦", "âœˆï¸ é£æœº"],
            placeholder_start: "è¾“å…¥èµ·ç‚¹",
            placeholder_dest: "è¾“å…¥ç›®çš„åœ°",
            button_plan: "è§„åˆ’è¡Œç¨‹",
            mode_labels: {"walk":"æ­¥è¡Œ", "bike":"è‡ªè¡Œè½¦", "car":"æ±½è½¦", "plane":"é£æœº"},
        },
        "es": {
            distance_time: "ğŸ“ Distancia y Tiempo",
            weather: "ğŸŒ¤ Clima",
            traffic: "ğŸš¦ TrÃ¡fico",
            transport_options: "ğŸš— Opciones de Transporte",
            recommendation: "ğŸ“¢ RecomendaciÃ³n",
            summary: "ğŸ“„ Resumen",
            transport_list: ["ğŸš— Coche", "ğŸš¶â€â™‚ï¸ Caminar", "ğŸš´â€â™‚ï¸ Bicicleta", "âœˆï¸ AviÃ³n"],
            placeholder_start: "Ingrese lugar de inicio",
            placeholder_dest: "Ingrese destino",
            button_plan: "Planificar viaje",
            mode_labels: {"walk":"Caminar", "bike":"Bicicleta", "car":"Coche", "plane":"AviÃ³n"},
        },
        "fr": {
            distance_time: "ğŸ“ Distance & Temps",
            weather: "ğŸŒ¤ MÃ©tÃ©o",
            traffic: "ğŸš¦ Trafic",
            transport_options: "ğŸš— Options de Transport",
            recommendation: "ğŸ“¢ Recommandation",
            summary: "ğŸ“„ RÃ©sumÃ©",
            transport_list: ["ğŸš— Voiture", "ğŸš¶â€â™‚ï¸ Marche", "ğŸš´â€â™‚ï¸ VÃ©lo", "âœˆï¸ Avion"],
            placeholder_start: "Entrez le lieu de dÃ©part",
            placeholder_dest: "Entrez la destination",
            button_plan: "Planifier le trajet",
            mode_labels: {"walk":"Marche", "bike":"VÃ©lo", "car":"Voiture", "plane":"Avion"},
        },
        "hi": {
            distance_time: "ğŸ“ à¤¦à¥‚à¤°à¥€ à¤”à¤° à¤¸à¤®à¤¯",
            weather: "ğŸŒ¤ à¤®à¥Œà¤¸à¤®",
            traffic: "ğŸš¦ à¤Ÿà¥à¤°à¥ˆà¤«à¤¼à¤¿à¤•",
            transport_options: "ğŸš— à¤ªà¤°à¤¿à¤µà¤¹à¤¨ à¤µà¤¿à¤•à¤²à¥à¤ª",
            recommendation: "ğŸ“¢ à¤¸à¥à¤à¤¾à¤µ",
            summary: "ğŸ“„ à¤¸à¤¾à¤°à¤¾à¤‚à¤¶",
            transport_list: ["ğŸš— à¤•à¤¾à¤°", "ğŸš¶â€â™‚ï¸ à¤ªà¥ˆà¤¦à¤²", "ğŸš´â€â™‚ï¸ à¤¬à¤¾à¤‡à¤•", "âœˆï¸ à¤µà¤¿à¤®à¤¾à¤¨"],
            placeholder_start: "à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­ à¤¸à¥à¤¥à¤¾à¤¨ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
            placeholder_dest: "à¤—à¤‚à¤¤à¤µà¥à¤¯ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
            button_plan: "à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤¯à¥‹à¤œà¤¨à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
            mode_labels: {"walk":"à¤ªà¥ˆà¤¦à¤²", "bike":"à¤¬à¤¾à¤‡à¤•", "car":"à¤•à¤¾à¤°", "plane":"à¤µà¤¿à¤®à¤¾à¤¨"},
        },
        "ja": {
            distance_time: "ğŸ“ è·é›¢ã¨æ™‚é–“",
            weather: "ğŸŒ¤ å¤©æ°—",
            traffic: "ğŸš¦ äº¤é€š",
            transport_options: "ğŸš— äº¤é€šæ‰‹æ®µ",
            recommendation: "ğŸ“¢ ãŠã™ã™ã‚",
            summary: "ğŸ“„ è¦ç´„",
            transport_list: ["ğŸš— è»Š", "ğŸš¶â€â™‚ï¸ æ­©ã", "ğŸš´â€â™‚ï¸ è‡ªè»¢è»Š", "âœˆï¸ é£›è¡Œæ©Ÿ"],
            placeholder_start: "å‡ºç™ºåœ°ã‚’å…¥åŠ›",
            placeholder_dest: "ç›®çš„åœ°ã‚’å…¥åŠ›",
            button_plan: "æ—…è¡Œè¨ˆç”»",
            mode_labels: {"walk":"å¾’æ­©", "bike":"è‡ªè»¢è»Š", "car":"è»Š", "plane":"é£›è¡Œæ©Ÿ"},
        },
        "de": {
            distance_time: "ğŸ“ Entfernung & Zeit",
            weather: "ğŸŒ¤ Wetter",
            traffic: "ğŸš¦ Verkehr",
            transport_options: "ğŸš— TransportmÃ¶glichkeiten",
            recommendation: "ğŸ“¢ Empfehlung",
            summary: "ğŸ“„ Zusammenfassung",
            transport_list: ["ğŸš— Auto", "ğŸš¶â€â™‚ï¸ Zu FuÃŸ", "ğŸš´â€â™‚ï¸ Fahrrad", "âœˆï¸ Flugzeug"],
            placeholder_start: "Startort eingeben",
            placeholder_dest: "Ziel eingeben",
            button_plan: "Reise planen",
            mode_labels: {"walk":"Zu FuÃŸ", "bike":"Fahrrad", "car":"Auto", "plane":"Flugzeug"},
        },
        "it": {
            distance_time: "ğŸ“ Distanza e Tempo",
            weather: "ğŸŒ¤ Meteo",
            traffic: "ğŸš¦ Traffico",
            transport_options: "ğŸš— Opzioni di Trasporto",
            recommendation: "ğŸ“¢ Raccomandazione",
            summary: "ğŸ“„ Sommario",
            transport_list: ["ğŸš— Auto", "ğŸš¶â€â™‚ï¸ A piedi", "ğŸš´â€â™‚ï¸ Bicicletta", "âœˆï¸ Aereo"],
            placeholder_start: "Inserisci luogo di partenza",
            placeholder_dest: "Inserisci destinazione",
            button_plan: "Pianifica viaggio",
            mode_labels: {"walk":"A piedi", "bike":"Bicicletta", "car":"Auto", "plane":"Aereo"},
        },
        "ru": {
            distance_time: "ğŸ“ Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ",
            weather: "ğŸŒ¤ ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°",
            traffic: "ğŸš¦ Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ",
            transport_options: "ğŸš— Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°",
            recommendation: "ğŸ“¢ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ",
            summary: "ğŸ“„ Ğ˜Ñ‚Ğ¾Ğ³",
            transport_list: ["ğŸš— ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ", "ğŸš¶â€â™‚ï¸ ĞŸĞµÑˆĞºĞ¾Ğ¼", "ğŸš´â€â™‚ï¸ Ğ’ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´", "âœˆï¸ Ğ¡Ğ°Ğ¼Ğ¾Ğ»ĞµÑ‚"],
            placeholder_start: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾",
            placeholder_dest: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿ÑƒĞ½ĞºÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ",
            button_plan: "ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ",
            mode_labels: {"walk":"ĞŸĞµÑˆĞºĞ¾Ğ¼", "bike":"Ğ’ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´", "car":"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ", "plane":"Ğ¡Ğ°Ğ¼Ğ¾Ğ»ĞµÑ‚"},
        }
    };

    // Speeds in km/h for each mode
    const modeSpeeds = {
        walk: 5,
        bike: 15,
        car: 60,
        plane: 800
    };

    // Helper to format time nicely
    function formatTime(hours) {
        if (hours === 0 || isNaN(hours)) return "N/A";
        if (hours < 1) {
            const minutes = Math.round(hours * 60);
            return minutes + " min";
        } else {
            return hours.toFixed(1) + " hr";
        }
    }

    // Update placeholders and button text on language change
    function updateUIStrings(lang) {
        const trans = uiTranslations[lang] || uiTranslations['en'];
        document.getElementById('start').placeholder = trans.placeholder_start;
        document.getElementById('dest').placeholder = trans.placeholder_dest;
        document.querySelector('button').textContent = trans.button_plan;
    }

    // Initially update placeholders/button
    updateUIStrings(langSelect.value);

    // Also update when language changes
    langSelect.addEventListener('change', () => {
        updateUIStrings(langSelect.value);
    });

    function planTrip(){
        const start = document.getElementById('start').value;
        const dest = document.getElementById('dest').value;
        const lang = document.getElementById('lang').value;
        const mode = document.getElementById('mode').value;
        const trans = uiTranslations[lang] || uiTranslations['en'];

        fetch('/plan', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({start, dest, lang, mode})
        })
        .then(res=>res.json())
        .then(data=>{
            if(data.error){
                document.getElementById('results').innerHTML = `<p style="color:red;">${data.error}</p>`;
                return;
            }

            // distance in km (number)
            const distance = data.distance || 0;

            // Build transport options with estimated time
            // Order: Walk, Bike, Car, Plane (to match UI order)
            const transportModes = ["walk", "bike", "car", "plane"];
            let transportHtml = "";
            transportModes.forEach(m => {
                const speed = modeSpeeds[m];
                const timeHrs = distance / speed;
                const formattedTime = formatTime(timeHrs);
                // mode icon and label from transport_list and modeLabels
                // We get icon from transport_list by index, label from mode_labels
                // Map: walk=1, bike=2, car=0, plane=3 (based on transport_list order)
                let icon = "";
                switch(m){
                    case "walk": icon = "ğŸš¶â€â™‚ï¸"; break;
                    case "bike": icon = "ğŸš´â€â™‚ï¸"; break;
                    case "car": icon = "ğŸš—"; break;
                    case "plane": icon = "âœˆï¸"; break;
                }
                const label = trans.mode_labels[m] || m;

                transportHtml += `<p>${icon} ${label} â€” ${formattedTime} (${distance} km)</p>`;
            });

            let html = `
            <div class="card"><h3>${trans.distance_time}</h3>
                <p>${data.distance} km, ${data.duration} min</p>
            </div>
            <div class="card"><h3>${trans.weather}</h3>
                <p>${data.weather.conditions}</p>
                <p>Temp: ${data.weather.temp}</p>
                <p>Humidity: ${data.weather.humidity}</p>
                <p>Wind: ${data.weather.wind}</p>
            </div>
            <div class="card"><h3>${trans.traffic}</h3>
                <p>${data.traffic}</p>
            </div>
            <div class="card"><h3>${trans.transport_options}</h3>
                ${transportHtml}
            </div>
            <div class="card recommendation"><h3>${trans.recommendation}</h3>
                <p>${data.recommendation}</p>
            </div>
            <div class="card summary"><h3>${trans.summary}</h3>
                <p>${data.output_text}</p>
            </div>`;
            document.getElementById('results').innerHTML = html;
            if(data.audio_path){
                new Audio(data.audio_path).play();
            }
        });
    }
</script>
</body>
</html>
